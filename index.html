<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>HRES Dashboard Standalone</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-slate-900 text-white">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;
const Recharts = window.Recharts;

const ControlSlider = ({ label, value, setValue, min, max, unit }) => (
  <div className="mb-4">
    <div className="flex justify-between text-xs text-slate-400 mb-1">
      <span>{label}</span>
      <span className="text-white font-bold">{value} {unit}</span>
    </div>
    <input 
      type="range" min={min} max={max} value={value} 
      onChange={e => setValue(parseFloat(e.target.value))}
      className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-green-500"
    />
  </div>
);

function HRESDashboard() {
  const [solar, setSolar] = useState(80);
  const [wind, setWind] = useState(50);
  const [load, setLoad] = useState(40);
  const [gridPrice, setGridPrice] = useState(1500);
  const [soc, setSoc] = useState(50);
  const [data, setData] = useState([]);
  const [isRunning, setIsRunning] = useState(true);
  const [gridActive, setGridActive] = useState(false);
  const [systemStatus, setSystemStatus] = useState("Idle");

  const MAX_SOLAR = 50;
  const MAX_WIND = 40;
  const BATTERY_CAP = 100;
  const SOC_MAX = 80;
  const SOC_MIN = 20;
  const GRID_EXP = 1400;

  useEffect(() => {
    if(!isRunning) return;
    const interval = setInterval(() => {
      // Noise
      const s = Math.max(0,(solar/100)*MAX_SOLAR + (solar>0?Math.random()*2-1:0));
      const w = Math.max(0,(wind/100)*MAX_WIND + (wind>0?Math.random()*3-1.5:0));
      const l = Math.max(0, load + Math.random()*2-1);
      const netLoad = l - (s+w);

      let newSoc = soc;
      let status = "Balanced";
      let useGrid = false;

      if(netLoad<0){
        if(soc<SOC_MAX){
          newSoc = Math.min(100, soc + Math.abs(netLoad)/BATTERY_CAP*5);
          status = "CHARGING";
        }
      } else {
        if(gridPrice>GRID_EXP){
          if(soc>SOC_MIN){
            newSoc = Math.max(0, soc - netLoad/BATTERY_CAP*5);
            status = "DISCHARGING";
          } else {
            useGrid = true;
            status = "FORCED GRID";
          }
        } else {
          useGrid = true;
          status = "USING GRID";
        }
      }

      setSoc(newSoc);
      setSystemStatus(status);
      setGridActive(useGrid);

      setData(prev=>{
        const d = [...prev, {time: new Date().toLocaleTimeString(), solar: parseFloat(s.toFixed(2)), wind: parseFloat(w.toFixed(2)), load: parseFloat(l.toFixed(2)), soc: parseFloat(newSoc.toFixed(1)), gridPrice}];
        if(d.length>30)d.shift();
        return d;
      });
    },1000);

    return ()=>clearInterval(interval);
  }, [isRunning, solar, wind, load, gridPrice, soc]);

  return (
    <div className="p-4 md:p-6">
      <h1 className="text-xl font-bold mb-4">HRES Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <ControlSlider label="Solar (%)" value={solar} setValue={setSolar} min={0} max={100}/>
          <ControlSlider label="Wind (%)" value={wind} setValue={setWind} min={0} max={100}/>
          <ControlSlider label="Load (kW)" value={load} setValue={setLoad} min={10} max={120}/>
          <ControlSlider label="Grid Price" value={gridPrice} setValue={setGridPrice} min={1000} max={2000}/>
          <p className="mt-2">Battery SOC: {soc.toFixed(1)}%</p>
          <p>System Status: {systemStatus}</p>
          <p>Grid: {gridActive?"ON":"OFF"}</p>
          <button onClick={()=>setIsRunning(!isRunning)} className="mt-2 px-3 py-1 bg-blue-600 rounded">{isRunning?"Pause":"Resume"}</button>
        </div>

        <div className="md:col-span-2">
          <div className="h-64 w-full mb-4">
            <Recharts.ResponsiveContainer width="100%" height="100%">
              <Recharts.AreaChart data={data}>
                <Recharts.CartesianGrid strokeDasharray="3 3" />
                <Recharts.XAxis dataKey="time" />
                <Recharts.YAxis />
                <Recharts.Tooltip />
                <Recharts.Area type="monotone" dataKey="solar" stroke="#fbbf24" fill="#fbbf24" />
                <Recharts.Area type="monotone" dataKey="wind" stroke="#22d3ee" fill="#22d3ee" />
                <Recharts.Line type="monotone" dataKey="load" stroke="#fff" />
              </Recharts.AreaChart>
            </Recharts.ResponsiveContainer>
          </div>
        </div>
      </div>
    </div>
  )
}

ReactDOM.render(<HRESDashboard/>, document.getElementById("root"));
</script>
</body>
</html>
